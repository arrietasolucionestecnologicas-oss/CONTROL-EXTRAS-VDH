<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDH Enterprise v8.5</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        :root { --vdh-primary: #0b1e47; --vdh-accent: #ffc107; }
        body { background-color: #f0f2f5; font-family: system-ui; }
        .d-none { display: none !important; }
        .bg-corporate { background-color: var(--vdh-primary) !important; color: white; }
        .btn-corporate { background-color: var(--vdh-primary); color: white; border: none; }
        .bg-admin { background: linear-gradient(135deg, #1a237e 0%, #283593 100%); color: white; }
        #loader { position: fixed; inset: 0; background: rgba(255,255,255,0.95); z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .card-custom { border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    </style>
</head>
<body>
    <div id="loader" class="d-none"><div class="spinner-border text-primary"></div><h6 class="text-muted fw-bold">Cargando...</h6></div>

    <div id="view-login" class="container mt-5 pt-5 app-view">
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-4">
                <div class="card card-custom p-4 text-center">
                    <div class="mb-4"><i class="bi bi-building-fill-lock" style="font-size: 3rem; color: var(--vdh-primary);"></i></div>
                    <h3 class="fw-bold" style="color: var(--vdh-primary)">VDH SYSTEM</h3>
                    <div class="form-floating mb-3 text-start"><select id="login-empresa-select" class="form-select"></select><label>Empresa</label></div>
                    <div class="form-floating mb-4 text-start"><input type="password" id="login-token" class="form-control" placeholder="Pass"><label>Contrase√±a</label></div>
                    <button onclick="app.login()" class="btn btn-corporate w-100 py-2 fw-bold">INGRESAR</button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-admin" class="app-view d-none">
        <nav class="navbar navbar-dark bg-admin mb-4 px-3 shadow"><span class="navbar-brand fw-bold">GERENCIA</span><button class="btn btn-sm btn-outline-light" onclick="app.logout()">Salir</button></nav>
        <div class="container"><div class="row g-4"><div class="col-md-4"><div class="card card-custom p-3"><h6 class="fw-bold text-success mb-3">Nueva Empresa</h6><input id="admin-new-name" class="form-control mb-2" placeholder="Nombre"><input id="admin-new-token" class="form-control mb-3" placeholder="Clave"><button class="btn btn-success w-100" onclick="app.adminCrearEmpresa()">CREAR</button></div></div><div class="col-md-8"><div class="card card-custom p-0" style="max-height:600px;overflow-y:auto"><div class="card-header bg-white fw-bold">Empresas <button onclick="app.refreshAdminList()" class="btn btn-sm btn-light float-end">‚Üª</button></div><ul class="list-group list-group-flush" id="admin-company-list"></ul></div></div></div></div>
    </div>

    <div id="view-contador" class="app-view d-none">
        <nav class="navbar navbar-dark bg-dark mb-4 px-3"><span class="navbar-brand fw-bold">N√ìMINA</span><span id="contador-empresa-label" class="badge bg-warning text-dark ms-2"></span><button class="btn btn-sm btn-outline-light ms-auto" onclick="app.volverAlPanel()">Volver</button></nav>
        <div class="container-fluid px-4">
            <ul class="nav nav-tabs mb-4">
                <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-valorizacion">Valorizaci√≥n</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-resumen">Resumen</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-config">Configuraci√≥n</button></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="tab-valorizacion"><div class="card card-custom table-responsive"><table class="table table-sm table-hover mb-0"><thead class="table-light"><tr><th>Fecha</th><th>Trabajador</th><th>Total</th><th>Ord</th><th>Rec.Noc</th><th>Ext.Diu</th><th>Ext.Noc</th><th>Dom</th><th>Ext.Dom</th><th class="text-end">A PAGAR</th><th>Ok</th></tr></thead><tbody id="tabla-valorizacion"></tbody></table></div></div>
                <div class="tab-pane fade" id="tab-resumen"><div class="card card-custom p-4"><table class="table table-bordered table-sm"><thead class="table-dark"><tr><th>Trabajador</th><th>Rec.Noc</th><th>Ext.Diu</th><th>Ext.Noc</th><th>Dom</th><th>Ext.Dom</th><th>TOTAL $</th></tr></thead><tbody id="tabla-resumen"></tbody></table></div></div>
                <div class="tab-pane fade" id="tab-config">
                    <div class="row g-4">
                        <div class="col-md-4"><div class="card card-custom p-4 bg-light"><h6 class="fw-bold mb-3">Festivos</h6><div class="input-group mb-3"><input type="number" id="input-anio-festivos" class="form-control" value="2026"><button class="btn btn-success" onclick="app.generarFestivos()">GENERAR</button></div><div class="small" style="max-height:200px;overflow-y:auto" id="lista-festivos-actuales"></div></div></div>
                        <div class="col-md-4"><div class="card card-custom p-4"><h6 class="fw-bold mb-3">Jornada</h6><div id="config-jornada-container"></div></div></div>
                        <div class="col-md-4"><div class="card card-custom p-4"><h6 class="fw-bold mb-3">Factores</h6><div class="row g-2"><div class="col-6"><label class="small">Divisor</label><input id="cfg-base-mes" class="form-control form-control-sm"></div><div class="col-6"><label class="small">Rec.Noc</label><input id="cfg-rec-noc" class="form-control form-control-sm"></div><div class="col-6"><label class="small">Ext.Diu</label><input id="cfg-ext-diu" class="form-control form-control-sm"></div><div class="col-6"><label class="small">Ext.Noc</label><input id="cfg-ext-noc" class="form-control form-control-sm"></div><div class="col-6"><label class="small">DomBase</label><input id="cfg-dom-fes" class="form-control form-control-sm"></div><div class="col-6"><label class="small">ExtDom</label><input id="cfg-ext-dom" class="form-control form-control-sm"></div></div><button class="btn btn-primary w-100 mt-3" onclick="app.guardarConfiguracionAvanzada()">GUARDAR</button></div></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="view-digitador" class="app-view d-none">
        <nav class="navbar navbar-dark bg-corporate px-3 shadow-sm"><span class="navbar-brand fw-bold">VDH APP</span><div><span id="nav-empresa-label" class="badge bg-warning text-dark me-2"></span><button class="btn btn-sm btn-outline-light" onclick="app.logout()">Salir</button></div></nav>
        <div class="container mt-4">
            <ul class="nav nav-tabs mb-3" id="digitador-tabs">
                <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#dig-form">üìù Registro</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#dig-historial" onclick="app.cargarHistorialDigitador()">üïí Historial</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#dig-equipo" onclick="app.fetchMetadata()">üë• Equipo</button></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="dig-form">
                    <div class="card card-custom p-4 mw-100 mx-auto" style="max-width: 600px;">
                        <form id="form-horas">
                            <input type="hidden" id="record-id"> <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="fw-bold text-secondary m-0">Registrar Turno</h5>
                                <button type="button" id="btn-cancel-edit" class="btn btn-sm btn-danger d-none" onclick="app.cancelarEdicion()">Cancelar Edici√≥n</button>
                            </div>
                            <div class="mb-3"><label class="small fw-bold">Fecha</label><input type="date" id="inputFecha" class="form-control" required></div>
                            <div class="mb-3"><label class="small fw-bold">Trabajador</label><div class="input-group"><select id="inputTrabajador" class="form-select" required></select><button type="button" class="btn btn-outline-secondary" onclick="modals.nuevoTrabajador()">+</button></div></div>
                            <div class="mb-3"><label class="small fw-bold">Cliente</label><div class="input-group"><select id="inputCliente" class="form-select" required></select><button type="button" class="btn btn-outline-secondary" onclick="modals.nuevoCliente()">+</button></div></div>
                            <div class="mb-3"><label class="small fw-bold">Actividad</label><input id="inputActividad" class="form-control" required></div>
                            <div class="row g-2 mb-3"><div class="col-6"><label class="small fw-bold">Entrada</label><input type="time" id="inputEntrada" class="form-control" required></div><div class="col-6"><label class="small fw-bold">Salida</label><input type="time" id="inputSalida" class="form-control" required></div></div>
                            <div class="form-check mb-3"><input type="checkbox" id="checkAlmuerzo" class="form-check-input" checked><label class="small">Descontar Almuerzo</label></div>
                            <button type="submit" id="btn-submit-horas" class="btn btn-corporate w-100 py-2">GUARDAR</button>
                        </form>
                    </div>
                </div>
                <div class="tab-pane fade" id="dig-historial">
                    <div class="card card-custom p-0 table-responsive">
                        <table class="table table-sm table-striped mb-0 small align-middle">
                            <thead class="table-dark"><tr><th>Fecha</th><th>Nombre</th><th>Cliente</th><th>Horas</th><th>Acciones</th></tr></thead>
                            <tbody id="tabla-historial-digitador"></tbody>
                        </table>
                    </div>
                </div>
                <div class="tab-pane fade" id="dig-equipo">
                    <div class="card card-custom p-4">
                        <h6 class="fw-bold mb-3">Actualizar Salarios</h6>
                        <div class="input-group mb-3">
                            <select id="edit-worker-select" class="form-select"></select>
                            <input id="edit-worker-new-salary" type="number" class="form-control" placeholder="Nuevo Salario">
                            <button class="btn btn-primary" onclick="app.actualizarSalario()">Actualizar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalTrabajador" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"><input id="new-worker-name" class="form-control mb-2" placeholder="Nombre"><input id="new-worker-salary" type="number" class="form-control" placeholder="Salario Base"></div><div class="modal-footer"><button onclick="modals.guardarTrabajador()" class="btn btn-primary btn-sm">Guardar</button></div></div></div></div>
    <div class="modal fade" id="modalCliente" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"><input id="new-client-name" class="form-control" placeholder="Cliente"></div><div class="modal-footer"><button onclick="modals.guardarCliente()" class="btn btn-primary btn-sm">Guardar</button></div></div></div></div>
    <div class="toast-container position-fixed bottom-0 end-0 p-3"><div id="liveToast" class="toast align-items-center text-white bg-primary border-0" role="alert"><div class="d-flex"><div class="toast-body" id="toast-message"></div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
